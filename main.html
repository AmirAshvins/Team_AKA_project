<!DOCTYPE html>
<html>

<head>
    <title>List Page</title>
    <meta lang="english">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/styles.css" type="text/css">
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>
    <script src="./js/scripts.js"></script>
</head>

<body>
    <!-- header -->
    <div class="jumbotron header-div header-footer-div">
        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"></div>
        <section class="col-lg-8 col-md-8 col-sm-8 col-xs-8 text-center align-center-up">
            <h2 class="head-text">Your List</h>
        </section>
        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-center align-center-up">
            <a id="profile" class="btn btn-default" href="###########"><span class="glyphicon glyphicon-user"></span></a>
        </div>
    </div>

    <!-- content -->
    <div class="container page-content">
        <div class="row section-header section-item">
            <p class="col-lg-4 col-md-4 col-sm-4 col-xs-4 section-heading list-text addMargin"> Due Date</p>
            <p class="col-lg-6 col-md-6 col-sm-6 col-xs-6 section-heading list-text addMargin"> Assignment Name</p>
            <p class="col-lg-2 col-md-2 col-sm-2 col-xs-2 section-heading list-text addMargin"> Course</p>
        </div>
        <div id="listContainer"></div>
    </div>

    <!-- footer -->
    <div class="jumbotron footer-div header-footer-div">
        <div class="row">
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-center">
                <a href="./calendar.html" class="btn foot-text" role="button">Calendar</a>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-center">
                <a href="./addasignment.html" class="btn foot-text">Add</a>
            </div>
        </div>
    </div>

    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyA_-CQ7oIjLIeTU8B05p8lD-UbOJ9MXm_Y",
            authDomain: "team-aka.firebaseapp.com",
            databaseURL: "https://team-aka.firebaseio.com",
            projectId: "team-aka",
            storageBucket: "team-aka.appspot.com",
            messagingSenderId: "192089508874",
            appId: "1:192089508874:web:15181dc2fc7a40725ce3f3"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        var db = firebase.firestore();
    </script>

    <script>
        function buildListRow(assignmentInstance) {

            // Build the main container
            let listRow = buildRow(assignmentInstance.ID);

            //build course name
            let courseNameCol = buildCourseNameCol(assignmentInstance.course);

            // build assignmentName
            let assignmentNameCol = buildAssignmentNameCol(assignmentInstance.name);

            // Build due date
            let dueDateCol = buildDueDateCol(assignmentInstance.dueDate)

            // put it all together
            listRow.appendChild(dueDateCol);
            listRow.appendChild(assignmentNameCol);
            listRow.appendChild(courseNameCol);
            document.getElementById('listContainer').appendChild(listRow);
        }

        function buildRow(assignmentId) {
            // Build a col of auto span
            let listRow = document.createElement('div');
            listRow.id = assignmentId;
            listRow.className = "section-item row list-row section-item";
            listRow.onclick = function() {
                document.location.href = "./details.html";
            }
            return listRow;
        }

        function buildCourseNameCol(courseName) {
            let courseNameCol = document.createElement('div');
            courseNameCol.className = "col-lg-2 col-md-2 col-sm-2 col-xs-2 text-right";
            courseNameCol.innerHTML = "<p class='list-course-name list-text'>" + courseName + "</p>";
            return courseNameCol;
        }

        function buildAssignmentNameCol(assignmentName) {
            let assignmentNameCol = document.createElement('div');
            assignmentNameCol.className = "col-lg-6 col-md-6 col-sm-6 col-xs-6 text-left";
            assignmentNameCol.innerHTML = "<p class='list-assignment-name list-text'>" + assignmentName + "</p>";
            return assignmentNameCol;
        }

        function buildDueDateCol(dueDate) {
            let dueDateCol = document.createElement('div');
            dueDateCol.className = "col-lg-4 col-md-4 col-sm-4 col-xs-4 text-left";
            dueDateCol.innerHTML = "<p class='list-due-date list-text'>" + dueDate + "</p>";
            return dueDateCol
        }

        db.collection("assignments").get().then(function (querySnapshot) {
            let assignmentList = [];
            querySnapshot.forEach(function (doc) {
                assignmentDetails = doc.data();
                newAssignment = new assignment(assignmentDetails['course'], assignmentDetails['name'], assignmentDetails['dueDate'],
                    assignmentDetails['d2lLink'], assignmentDetails['instructions'],
                    assignmentDetails['additionalInformation'], assignmentDetails['instructorID']);
                assignmentList.push(newAssignment);
                buildListRow(newAssignment);
            });
            window.localStorage.setItem("list", JSON.stringify(assignmentList));
            console.log(JSON.parse(window.localStorage.getItem('list')));
        });
    </script>
</body>

</html>